(window.webpackJsonp=window.webpackJsonp||[]).push([[22],{371:function(t,a,s){"use strict";s.r(a);var n=s(42),e=Object(n.a)({},(function(){var t=this,a=t.$createElement,s=t._self._c||a;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h2",{attrs:{id:"浏览器相关"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#浏览器相关"}},[t._v("#")]),t._v(" 浏览器相关")]),t._v(" "),s("h3",{attrs:{id:"跨域"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#跨域"}},[t._v("#")]),t._v(" 跨域")]),t._v(" "),s("p",[t._v("同源：协议，域名，端口号三者都相同，我们称之为同源。")]),t._v(" "),s("p",[t._v("同源策略：只有浏览器才受到同源策略的限制。即不同源的脚本在没有授权的情况下，不能读写对方的资源。比如我们打开了"),s("code",[t._v("A.com")]),t._v("，之后又在没有许可的情况下向"),s("code",[t._v("B.com")]),t._v("发送请求，通常这个请求是失败的。想要摆脱同源策略的限制，就得使用下面介绍的跨域手段了。")]),t._v(" "),s("p",[t._v("下面介绍了许多种跨域手段，最常用的是"),s("code",[t._v("CORS")]),t._v("和反向代理。")]),t._v(" "),s("h5",{attrs:{id:"jsonp"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#jsonp"}},[t._v("#")]),t._v(" JSONP")]),t._v(" "),s("p",[t._v("客户端")]),t._v(" "),s("div",{staticClass:"language-html extra-class"},[s("pre",{pre:!0,attrs:{class:"language-html"}},[s("code",[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("script")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),s("span",{pre:!0,attrs:{class:"token script"}},[s("span",{pre:!0,attrs:{class:"token language-javascript"}},[t._v("\n\t"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("doSomething")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("json")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    \t"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//do something")]),t._v("\n\t"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("script")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("script")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("src")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("http://api.example.com/data?callback=doSomething&parma=a"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),s("span",{pre:!0,attrs:{class:"token script"}}),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("script")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n")])])]),s("p",[t._v("服务端")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[t._v("ctx"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("body "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token template-string"}},[s("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("doSomething(")]),s("span",{pre:!0,attrs:{class:"token interpolation"}},[s("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("${")]),t._v("myJson"),s("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("}")])]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 传参")]),t._v("\n")])])]),s("p",[t._v("缺点："),s("strong",[t._v("仅支持GET请求")]),t._v("，安全性低")]),t._v(" "),s("h5",{attrs:{id:"document-domain"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#document-domain"}},[t._v("#")]),t._v(" document.domain")]),t._v(" "),s("p",[t._v("Cookie 是服务器写入浏览器的一小段信息，只有同源的网页才能共享。但是，两个网页一级域名相同，只是二级域名不同，浏览器允许通过设置"),s("code",[t._v("document.domain")]),t._v("共享 Cookie。")]),t._v(" "),s("p",[t._v("如a.example.com和b.example.com。")]),t._v(" "),s("p",[t._v("此时两个网站都设置 "),s("code",[t._v('document.domain = "example.com"')]),t._v("， 那么两个网页就可以共享Cookie了。")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// a.example.com")]),t._v("\ndocument"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("cookie "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'aaa'")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// b.example.com ")]),t._v("\nconsole"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("document"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("cookie"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 'aaa'")]),t._v("\n")])])]),s("h5",{attrs:{id:"window-name"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#window-name"}},[t._v("#")]),t._v(" window.name")]),t._v(" "),s("p",[t._v("这个方法主要用于"),s("strong",[t._v("父窗口和iframe窗口的通信")]),t._v("。")]),t._v(" "),s("p",[t._v("如果父窗口和iframe窗口是不同源的，则通常无法进行通信。")]),t._v(" "),s("div",{staticClass:"language-html extra-class"},[s("pre",{pre:!0,attrs:{class:"language-html"}},[s("code",[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("html")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("body")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("\x3c!-- 我是父窗口 --\x3e")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("iframe")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("src")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("'")]),t._v("xxx.com"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("'")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("\x3c!-- 我是子窗口 --\x3e")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("iframe")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("body")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("html")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n")])])]),s("p",[s("code",[t._v("window.name")]),t._v("特点：无论是否同源，只要在同一个窗口里，前一个网页设置了这个属性，后一个网页可以读取它。")]),t._v(" "),s("p",[t._v("例如，我们在a.com页面下设置")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[t._v("window"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("name "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'123'")]),t._v("\nlocation"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("href "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'b.com'")]),t._v("\n")])])]),s("p",[t._v("然后在b.com也能获取到"),s("code",[t._v("window.name")]),t._v("的值。")]),t._v(" "),s("p",[t._v("实现跨域：")]),t._v(" "),s("p",[t._v("使用时，先设置"),s("code",[t._v("iframe")]),t._v("的"),s("code",[t._v("src")]),t._v("为我们想要通信的目标页面。当目标页面的"),s("code",[t._v("window.name")]),t._v("修改时，将我们的"),s("code",[t._v("iframe")]),t._v("的"),s("code",[t._v("src")]),t._v("修改为一个和父窗口同源的页面。")]),t._v(" "),s("p",[t._v("本质：")]),t._v(" "),s("p",[t._v("iframe内的目标页面 <=> iframe内的一个和父窗口同源的页面 <=> 父窗口")]),t._v(" "),s("h5",{attrs:{id:"location-hash"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#location-hash"}},[t._v("#")]),t._v(" location.hash")]),t._v(" "),s("p",[t._v("这个方法也是主要用于"),s("strong",[t._v("父窗口和iframe窗口的通信")]),t._v("。")]),t._v(" "),s("p",[t._v("特点：如果只是改变片段标识符(fragment/hash)，页面不会重新刷新。")]),t._v(" "),s("p",[t._v("实现跨域：")]),t._v(" "),s("p",[t._v("父窗口修改"),s("code",[t._v("iframe")]),t._v("窗口的"),s("code",[t._v("src")])]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 父窗口")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" src "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token template-string"}},[s("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")]),s("span",{pre:!0,attrs:{class:"token interpolation"}},[s("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("${")]),t._v("originUrl"),s("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("}")])]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("#")]),s("span",{pre:!0,attrs:{class:"token interpolation"}},[s("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("${")]),t._v("data"),s("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("}")])]),s("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")])]),t._v("\ndocument"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("querySelector")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'iframe'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("src "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" src\n")])])]),s("p",[s("code",[t._v("iframe")]),t._v("窗口的页面不会刷新，但是能知道"),s("code",[t._v("hash")]),t._v("的变化")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// iframe窗口")]),t._v("\nwindow"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("onhashchange")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("p",[t._v("同理，"),s("code",[t._v("iframe")]),t._v("窗口也可以改变父窗口的"),s("code",[t._v("hash")]),t._v("来实现通信。")]),t._v(" "),s("h5",{attrs:{id:"cors"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#cors"}},[t._v("#")]),t._v(" CORS")]),t._v(" "),s("p",[t._v("CORS（Cross-Origin ResourceSharing）跨域资源共享")]),t._v(" "),s("p",[t._v("只需要后端在响应头设置"),s("code",[t._v("Access-Control-Allow-Origin: *")]),t._v("， * 为任意Origin，也可以指定Origin")]),t._v(" "),s("p",[t._v("使用CORS时默认不发送Cookie，想要发送Cookie需要:")]),t._v(" "),s("ol",[s("li",[t._v("设置"),s("code",[t._v("Access-Control-Allow-Credentials: true")])]),t._v(" "),s("li",[t._v("此时"),s("code",[t._v("Access-Control-Allow-Origin")]),t._v("不能设置为 * ，必须指定Origin")])]),t._v(" "),s("p",[t._v("浏览器把请求分为简单请求与非简单请求")]),t._v(" "),s("p",[t._v("简单请求必须满足以下两大条件")]),t._v(" "),s("ol",[s("li",[t._v("请求方法为 HEAD / GET / POST")]),t._v(" "),s("li",[t._v("HTTP头部不超过以下几种\n"),s("ol",[s("li",[t._v("Accept")]),t._v(" "),s("li",[t._v("Accept-Language")]),t._v(" "),s("li",[t._v("Content-Language")]),t._v(" "),s("li",[t._v("Last-Event-ID")]),t._v(" "),s("li",[t._v("Content-Type：只限于三个值"),s("code",[t._v("application/x-www-form-urlencoded")]),t._v("、"),s("code",[t._v("multipart/form-data")]),t._v("、"),s("code",[t._v("text/plain")])])])])]),t._v(" "),s("p",[t._v("不满足的就为非简单请求。")]),t._v(" "),s("p",[t._v('非简单请求的CORS请求，会在正式通信之前，增加一次HTTP查询请求，称为"预检"请求。')]),t._v(" "),s("p",[t._v("这个请求的请求方法为"),s("code",[t._v("OPTIONS")]),t._v(" ，预检请求的头部还会包括以下几个字段")]),t._v(" "),s("p",[s("code",[t._v("Origin")])]),t._v(" "),s("p",[s("code",[t._v("Access-Control-Request-Method")]),t._v(" 用来表示非简单请求的请求方法")]),t._v(" "),s("p",[s("code",[t._v("Access-Control-Request-Headers")]),t._v("  用来表示非简单请求的额外头部，例如自定义头部")]),t._v(" "),s("h5",{attrs:{id:"postmessage"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#postmessage"}},[t._v("#")]),t._v(" postMessage")]),t._v(" "),s("p",[t._v("跨文档通信。比起"),s("code",[t._v("window.name")]),t._v("和"),s("code",[t._v("location.hash")]),t._v("，该方法更加方便。")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[t._v("window"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("postMessage")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'message'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" url"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" \n\nwindow"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("on")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'message'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("e")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    console"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("e"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("data"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("h5",{attrs:{id:"反向代理"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#反向代理"}},[t._v("#")]),t._v(" 反向代理")]),t._v(" "),s("p",[t._v("由于同源策略是浏览器的策略。")]),t._v(" "),s("p",[s("code",[t._v("A.com:80")]),t._v("不能向"),s("code",[t._v("B.com:3000")]),t._v("发送请求。那我们可以在"),s("code",[t._v("A.com:8080")]),t._v("设置一个代理服务器来代理请求，之后发请求就是"),s("code",[t._v("A.com:80 -> A.com:8080 -> B.com:3000")]),t._v("，此时请求可以成功发过去。")]),t._v(" "),s("p",[t._v("通常我们本地开发项目是使用"),s("code",[t._v("webpack-dev-server")]),t._v("，而它自带了代理服务器的功能（只需要我们在配置文件中加上"),s("code",[t._v("proxy")]),t._v("），所以可以轻松解决跨域问题。除此之外我们也可以使用"),s("code",[t._v("nginx")]),t._v("来进行反向代理。")]),t._v(" "),s("h3",{attrs:{id:"浏览器渲染机制"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#浏览器渲染机制"}},[t._v("#")]),t._v(" 浏览器渲染机制")]),t._v(" "),s("ol",[s("li",[t._v("浏览器先对得到的HTML进行解码，之后进行网络资源的预处理，将以后要发送的请求提前加进请求队列中。")]),t._v(" "),s("li",[t._v("浏览器将HTML转化为一个个的标记（标记化Tokenization），之后通过标记来构建DOM树；CSS同理，先进行标记化，再进行CSS样式树的构建。")]),t._v(" "),s("li",[t._v("浏览器将DOM树和CSS样式树结合，生成渲染树。")]),t._v(" "),s("li",[t._v("布局：浏览器根据渲染树，获取每个渲染对象在屏幕上的位置和尺寸。")]),t._v(" "),s("li",[t._v("绘制：将计算好的像素点绘制到屏幕。")]),t._v(" "),s("li",[t._v("渲染层合成：多个绘制后的渲染层按照恰当的重叠顺序进行合并，而后生成位图，最终通过显卡展示到屏幕上。")])]),t._v(" "),s("h5",{attrs:{id:"回流-重排"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#回流-重排"}},[t._v("#")]),t._v(" 回流/重排")]),t._v(" "),s("p",[t._v("​\t"),s("strong",[t._v("当渲染对象的位置，尺寸，或某些属性发生改变时，浏览器重新渲染部分或全部文档的过程。")])]),t._v(" "),s("p",[t._v("导致回流的操作：")]),t._v(" "),s("ol",[s("li",[s("p",[t._v("页面首次渲染")])]),t._v(" "),s("li",[s("p",[t._v("元素位置或尺寸发生变化。")])]),t._v(" "),s("li",[s("p",[t._v("添加或删除可见的DOM元素。")])]),t._v(" "),s("li",[s("p",[t._v("浏览器窗口大小发生变化。")])]),t._v(" "),s("li",[s("p",[t._v("查询某些属性或调用某些方法")]),t._v(" "),s("p",[s("code",[t._v("clientWidth")]),t._v("、"),s("code",[t._v("clientHeight")]),t._v("、"),s("code",[t._v("clientTop")]),t._v("、"),s("code",[t._v("clientLeft")])]),t._v(" "),s("p",[s("code",[t._v("offsetWidth")]),t._v("、"),s("code",[t._v("offsetHeight")]),t._v("、"),s("code",[t._v("offsetTop")]),t._v("、"),s("code",[t._v("offsetLeft")])]),t._v(" "),s("p",[s("code",[t._v("scrollWidth")]),t._v("、"),s("code",[t._v("scrollHeight")]),t._v("、"),s("code",[t._v("scrollTop")]),t._v("、"),s("code",[t._v("scrollLeft")])]),t._v(" "),s("p",[s("code",[t._v("scrollIntoView()")]),t._v("、"),s("code",[t._v("scrollIntoViewIfNeeded()")])]),t._v(" "),s("p",[s("code",[t._v("getComputedStyle()")])]),t._v(" "),s("p",[s("code",[t._v("getBoundingClientRect()")])]),t._v(" "),s("p",[s("code",[t._v("scrollTo()")])])])]),t._v(" "),s("h5",{attrs:{id:"重绘"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#重绘"}},[t._v("#")]),t._v(" 重绘")]),t._v(" "),s("p",[t._v("​\t"),s("strong",[t._v("样式的改变不改变渲染对象在文档流中的位置时（如：color, background-color的改变）浏览器重新绘制。")])]),t._v(" "),s("p",[s("strong",[t._v("回流一定引发重绘，重绘不一定引发回流。回流比重绘的代价要更高")]),t._v("。")]),t._v(" "),s("h5",{attrs:{id:"优化"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#优化"}},[t._v("#")]),t._v(" 优化")]),t._v(" "),s("ol",[s("li",[s("p",[t._v("浏览器会维护一定队列，所有引起回流或重绘的操作会放进这个队列，一定时间后会对这些操作进行批处理。")]),t._v(" "),s("p",[t._v("但当访问clientWidth, clientHeight之类的属性时，会刷新这个队列，所以要尽量减少这些属性的访问")])]),t._v(" "),s("li",[s("p",[t._v("浏览器使用的流式布局模型，避免使用table。")])]),t._v(" "),s("li",[s("p",[t._v("对DOM元素进行修改时，可以先使用"),s("code",[t._v("display: none")]),t._v("使其脱离文档流，再进行DOM操作，执行完再放回文档流。")])]),t._v(" "),s("li",[s("p",[t._v("对于复杂的动画效果，可以用"),s("code",[t._v("display: position")]),t._v("使其脱离文档流")])]),t._v(" "),s("li",[s("p",[t._v("使用CSS3中的"),s("code",[t._v("transform, opacity, filters")]),t._v("属性，启动GPU加速，这些属性的改变不会引发回流或重绘。")])])]),t._v(" "),s("h3",{attrs:{id:"浏览器事件模型"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#浏览器事件模型"}},[t._v("#")]),t._v(" 浏览器事件模型")]),t._v(" "),s("h5",{attrs:{id:"事件传播"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#事件传播"}},[t._v("#")]),t._v(" 事件传播")]),t._v(" "),s("div",{staticClass:"language-html extra-class"},[s("pre",{pre:!0,attrs:{class:"language-html"}},[s("code",[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("body")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("div")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("class")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("outer"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("div")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("class")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("inner"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("div")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("div")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("body")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n")])])]),s("p",[t._v("当我们点击inner元素的时候。")]),t._v(" "),s("p",[t._v("步骤①：点击事件传播途径：body -> outer -> inner 。这个过程从外往里，所以叫做事件捕获。")]),t._v(" "),s("p",[t._v("步骤②：点击事件传播途径：inner -> outer -> body 。这个过程从里往外，所以叫做事件冒泡。")]),t._v(" "),s("p",[t._v("总结而言，点击一个元素后，点击事件从外层元素开始向内传播（称为事件捕获），直到我们的被点击元素（event.target），之后从被点击元素开始向外传播（称为事件冒泡）")]),t._v(" "),s("h5",{attrs:{id:"阻止事件传播"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#阻止事件传播"}},[t._v("#")]),t._v(" 阻止事件传播")]),t._v(" "),s("p",[t._v("当我们点击inner元素时，点击事件的传播路径如下")]),t._v(" "),s("p",[t._v("①outer触发点击事件(捕获标志) -> ②inner触发点击事件(捕获标志) -> ③inner触发点击事件(冒泡标志) -> ④outer触发点击事件(冒泡标志)")]),t._v(" "),s("p",[t._v("我们可以使用"),s("strong",[t._v("event.stopPropagation")]),t._v("来阻止事件的传播。")]),t._v(" "),s("div",{staticClass:"language-javascript extra-class"},[s("pre",{pre:!0,attrs:{class:"language-javascript"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" inner "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" document"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("querySelector")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'.inner'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" outer "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" document"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("querySelector")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'.outer'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\ninner"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("addEventListener")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'click'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("e")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    e"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("stopPropagation")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\nouter"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("addEventListener")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'click'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("e")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    inner"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("style"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("display "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'none'")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("h5",{attrs:{id:"事件代理-事件委托"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#事件代理-事件委托"}},[t._v("#")]),t._v(" 事件代理/事件委托")]),t._v(" "),s("p",[t._v("事件代理是由"),s("strong",[t._v("event.target")]),t._v("实现的")]),t._v(" "),s("div",{staticClass:"language-javascript extra-class"},[s("pre",{pre:!0,attrs:{class:"language-javascript"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" ul "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" document"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("querySelector")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"ul"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\nul"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("addEventListener")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"click"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("e")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    console"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("e"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("target"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("innerHTML"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("p",[s("strong",[t._v("事件代理的好处")]),t._v("：")]),t._v(" "),s("ol",[s("li",[t._v("减少内存的使用，只用给一个元素监听事件")]),t._v(" "),s("li",[t._v("当动态增加或删除节点的时候，不用手动重新监听事件")])]),t._v(" "),s("h3",{attrs:{id:"浏览器客户端存储"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#浏览器客户端存储"}},[t._v("#")]),t._v(" 浏览器客户端存储")]),t._v(" "),s("h5",{attrs:{id:"localstorage"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#localstorage"}},[t._v("#")]),t._v(" LocalStorage")]),t._v(" "),s("p",[t._v("​\t"),s("strong",[t._v("持久化的本地存储，除非主动删除，否则数据不会过期。")])]),t._v(" "),s("h5",{attrs:{id:"sessionstorage"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#sessionstorage"}},[t._v("#")]),t._v(" SessionStorage")]),t._v(" "),s("p",[t._v("​\t"),s("strong",[t._v("会话结束（关闭页面）后，数据清除。")])]),t._v(" "),s("h5",{attrs:{id:"cookie"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#cookie"}},[t._v("#")]),t._v(" Cookie")]),t._v(" "),s("p",[t._v("浏览器发送HTTP请求时，先检查是否有相应的Cookie，如果有则将Cookie放在请求头中的Cookie字段中发送。")]),t._v(" "),s("ol",[s("li",[t._v("expires: 设置Cookie的过期时间")]),t._v(" "),s("li",[t._v("secure: 当secure为true时只能使用https")]),t._v(" "),s("li",[t._v("httpOnly: 设置浏览器能否读取Cookie")]),t._v(" "),s("li",[t._v("domain和path: 限制Cookie能被哪些URL访问")]),t._v(" "),s("li",[t._v("SameSite")])]),t._v(" "),s("p",[s("strong",[t._v("封装Cookie")])]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" cookieUtil "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("setItem")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("name"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" value"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" days")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" date "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Date")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        date"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("setDate")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("date"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("getDate")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" days"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        document"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("cookie "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token template-string"}},[s("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")]),s("span",{pre:!0,attrs:{class:"token interpolation"}},[s("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("${")]),t._v("name"),s("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("}")])]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token interpolation"}},[s("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("${")]),t._v("value"),s("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("}")])]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v(";expires=")]),s("span",{pre:!0,attrs:{class:"token interpolation"}},[s("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("${")]),t._v("date"),s("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("}")])]),s("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")])]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("getItem")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" arr "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" document"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("cookie"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("split")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("';'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" ret \n        arr"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("forEach")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("item")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" tempArr "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" item"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("split")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'='")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("tempArr"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("===")]),t._v(" name"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                ret "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" tempArr"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" ret\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("removeItem")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("setItem")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("name"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n")])])]),s("p",[t._v("Cookie和Storage的对比")]),t._v(" "),s("p",[t._v("Cookie存放数据小，4KB左右；而Storage可以存放5MB左右。")]),t._v(" "),s("p",[t._v("Cookie可以设置过期时间，SessionStorage会在会话关闭时清除，LocalStorage必须要手动清除。")]),t._v(" "),s("p",[t._v("Cookie参与和服务器的通信，Storage则一般不用于。")]),t._v(" "),s("h5",{attrs:{id:"session"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#session"}},[t._v("#")]),t._v(" Session")]),t._v(" "),s("p",[t._v("通常使用Cookie时，会话数据都存在Cookie中。使用Session时，Cookie中只存放一个Session_id，会话数据放在服务端的内存或数据库中。")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://pic3.zhimg.com/v2-b4c952a1f71313670b94898b2bea4f6a_r.jpg",alt:"Session鉴权原理"}})]),t._v(" "),s("h5",{attrs:{id:"jwt-json-web-token"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#jwt-json-web-token"}},[t._v("#")]),t._v(" JWT （JSON Web Token）")]),t._v(" "),s("p",[t._v("同样是用来做鉴权。Session的一个缺点就是由于会话数据保存在服务端，所以在使用服务器集群的时候处理起来很麻烦。而使用JWT的话，会话数据都保存在客户端，就没有这种问题了。")]),t._v(" "),s("p",[t._v("JWT是个很长的字符串，中间用两个"),s("code",[t._v(".")]),t._v("分割为三个部分，三个部分依次如下：Header（头部）， Payload（负载），Signature（签名）")]),t._v(" "),s("h6",{attrs:{id:"header"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#header"}},[t._v("#")]),t._v(" Header")]),t._v(" "),s("p",[t._v("头部是个JSON对象，结构通常如下")]),t._v(" "),s("div",{staticClass:"language-json extra-class"},[s("pre",{pre:!0,attrs:{class:"language-json"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"alg"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"HS256"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"typ"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"JWT"')]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("p",[t._v("alg属性表示签名的算法，默认为HMAC SHA256(写成HS256)。")]),t._v(" "),s("p",[t._v("typ属性表示这个token的类型，通常为“JWT”")]),t._v(" "),s("p",[t._v("最后使用Base64URL把这个JSON对象转化为字符串")]),t._v(" "),s("h6",{attrs:{id:"payload"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#payload"}},[t._v("#")]),t._v(" Payload")]),t._v(" "),s("p",[t._v("负载也是个JSON对象，存放需要传输的数据。除去官方字段，可以在这里定义私有字段。")]),t._v(" "),s("h6",{attrs:{id:"signature"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#signature"}},[t._v("#")]),t._v(" Signature")]),t._v(" "),s("p",[t._v("Signature 部分是对前两部分的签名，防止数据篡改")]),t._v(" "),s("div",{staticClass:"language-javascript extra-class"},[s("pre",{pre:!0,attrs:{class:"language-javascript"}},[s("code",[s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("HMACSHA256")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("Base64URL")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("header"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"."')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("Base64URL")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("payload"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\nsecret\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("p",[t._v("其中secret为服务端指定的密钥。")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://pic3.zhimg.com/v2-f1556c71042566d4a6f69ee20c2870ae_r.jpg",alt:"JWT鉴权原理"}})]),t._v(" "),s("h3",{attrs:{id:"cors与csrf与samesite"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#cors与csrf与samesite"}},[t._v("#")]),t._v(" CORS与CSRF与sameSite")]),t._v(" "),s("blockquote",[s("p",[t._v("一点小的思考")])]),t._v(" "),s("p",[t._v("案例：")]),t._v(" "),s("p",[t._v("a.com（下文简称a域）用于提供网站静态资源，b.com（下文简称b域）用于提供API接口。")]),t._v(" "),s("p",[t._v("访问b域的某个接口后，浏览器被种下值为"),s("code",[t._v("name=akara")]),t._v("的Cookie，此Cookie的Domain属性为b.com，表示该Cookie只能被发给b域。")]),t._v(" "),s("p",[s("strong",[t._v("CORS")])]),t._v(" "),s("p",[t._v("因为浏览器的同源策略的限制，a域无法直接向b域发送请求。为解决跨域问题，最方便的方式是CORS（跨域资源共享）。")]),t._v(" "),s("p",[t._v("通过设置"),s("code",[t._v("Access-Control-Allow-Origin")]),t._v("的响应头部，简单的请求就会被允许从a域送达b域，不过此时请求不会自动带上b域的Cookie。")]),t._v(" "),s("p",[t._v("通过设置"),s("code",[t._v("Access-Control-Allow-Credentials")]),t._v("响应头部，Cookie才能被一起发过去。")]),t._v(" "),s("p",[t._v("而对于复杂请求，在正式发送请求时需要发送一次请求方式为OPTION的报文，称之为预检（preflight）。")]),t._v(" "),s("p",[t._v("预检请求会带上一下两个请求头部，头部的值为正式请求的方法和头部。")]),t._v(" "),s("div",{staticClass:"language-http extra-class"},[s("pre",{pre:!0,attrs:{class:"language-http"}},[s("code",[s("span",{pre:!0,attrs:{class:"token header-name keyword"}},[t._v("Access-Control-Request-Headers:")]),t._v(" content-type\n"),s("span",{pre:!0,attrs:{class:"token header-name keyword"}},[t._v("Access-Control-Request-Method:")]),t._v(" POST\n")])])]),s("p",[t._v("而预检响应会带上四个响应头部")]),t._v(" "),s("div",{staticClass:"language-http extra-class"},[s("pre",{pre:!0,attrs:{class:"language-http"}},[s("code",[s("span",{pre:!0,attrs:{class:"token header-name keyword"}},[t._v("Access-Control-Allow-Credentials:")]),t._v(" true\n"),s("span",{pre:!0,attrs:{class:"token header-name keyword"}},[t._v("Access-Control-Allow-Origin:")]),t._v(" http://a.com\n"),s("span",{pre:!0,attrs:{class:"token header-name keyword"}},[t._v("Access-Control-Allow-Headers:")]),t._v(" content-type\n"),s("span",{pre:!0,attrs:{class:"token header-name keyword"}},[t._v("Access-Control-Allow-Methods:")]),t._v(" GET, POST, PATCH, PUT, DELETE, OPTIONS\n")])])]),s("p",[t._v("多出来的两个响应头也是需要后端进行设置的。")]),t._v(" "),s("p",[t._v("在预检请求通过之后，正式请求才能被发给后端。")]),t._v(" "),s("p",[s("strong",[t._v("CSRF")])]),t._v(" "),s("p",[t._v("现在假设a域是一个恶意的网站，b域是一个正常的网站。")]),t._v(" "),s("p",[t._v("当我们访问过b域，可以得到b域的Cookie；此时当我们访问a域，在a域给b域发送请求，这个请求会带上b域的Cookie，因此b域收到请求后会执行某些危险操作。")]),t._v(" "),s("p",[t._v("先停一下。")]),t._v(" "),s("p",[t._v("因为我上文讲了CORS，那当读者看到这一段的时候，有可能误以为b域名也使用了CORS，然后就以为CORS会带来CSRF的安全问题。")]),t._v(" "),s("p",[t._v("CSRF攻击成功的一大关键就是a域发送给b域的请求必须携带b域的Cookie，而CORS的"),s("code",[t._v("access-control-allow-credentials")]),t._v("确实可以让我们带上Cookie，但是注意到一个使用CORS的规定，我们无法同时设置以下两个头部")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("access-control-allow-origin: *\naccess-control-allow-credentials: true\n")])])]),s("p",[t._v("有权携带Cookie的域必须是特定的域，因此通过这个规定，CORS并不会带来CSRF的危险。")]),t._v(" "),s("p",[t._v("回到我们的例子，实际上这里所说的请求并不是跨域AJAX请求，比如它可以是通过表单发送的请求，而通过表单发送的请求是不受同源策略所限制的，因此即使b域没有设置任何东西，a域也可以把带有b域的请求发送给b域，从而达到攻击的目的。")]),t._v(" "),s("p",[s("strong",[t._v("sameSite")])]),t._v(" "),s("p",[t._v("我们以前有一些防御CSRF的手段，而chrome80版本之后也给cookie新增了一个属性，"),s("code",[t._v("sameSite")]),t._v("。")]),t._v(" "),s("p",[s("code",[t._v("sameSite")]),t._v("有三个属性，"),s("code",[t._v("strict")]),t._v("，"),s("code",[t._v("lax")]),t._v(",  "),s("code",[t._v("none")]),t._v("。")]),t._v(" "),s("ul",[s("li",[s("code",[t._v("strict")]),t._v("表示非同站的请求不能带上Cookie，比如a域发给b域的任何请求都无法带上Cookie。")]),t._v(" "),s("li",[s("code",[t._v("none")]),t._v("则没有任何限制，a域发给b域的请求都可以带上Cookie，不过使用这个值的时候Cookie也必须带上secure属性，表示b域使用的HTTPS协议。")]),t._v(" "),s("li",[s("code",[t._v("lax")]),t._v("只允许部分第三方请求带上Cookie，比如AJAX和表单提交的POST请求都无法发给b域。")])]),t._v(" "),s("p",[t._v("现代浏览器设置的Cookie的samesite属性默认为"),s("code",[t._v("lax")]),t._v("，主要目的是帮我们抵御CSRF攻击。")]),t._v(" "),s("p",[t._v("但是问题也随之而来，当我们使用CORS实现跨域发送带Cookie的请求，在以前应该是没有问题的，而现在因为"),s("code",[t._v("samesite")]),t._v("这个属性，跨域的请求无法带上Cookie。")]),t._v(" "),s("p",[t._v("那我们应该如何处理这个问题呢？第一反应是设置Cookie的时候，将SameSite属性设置为None。但是很多公司内部的站点都是用的HTTP协议，特意去弄一个证书感觉有点麻烦。")]),t._v(" "),s("p",[t._v("一种比较方便的方式是让两个站点是同站，比如a.qq.com与b.qq.com，因为是samesite，请求就可以带上Cookie了。")]),t._v(" "),s("p",[s("strong",[t._v("总结")])]),t._v(" "),s("ul",[s("li",[t._v("CORS可以让我们轻松处理跨域问题。")]),t._v(" "),s("li",[t._v("CSRF是普遍存在的问题。")]),t._v(" "),s("li",[t._v("借助sameSite的防御CSRF。")]),t._v(" "),s("li",[t._v("CORS + Samesite 可能使得请求无法带上Cookie，我们可以让站点同站，比如a.qq.com和b.qq.com。")])])])}),[],!1,null,null,null);a.default=e.exports}}]);